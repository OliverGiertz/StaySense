<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>StaySense NRW MVP</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="vendor/leaflet/leaflet.css" />
  </head>
  <body>
    <div class="background haze-a"></div>
    <div class="background haze-b"></div>

    <header class="top">
      <h1>StaySense</h1>
      <p>Kreis Mettmann Pilot: ruhige Nacht in weniger als 10 Sekunden bewerten.</p>
      <small id="network-status">Netzwerkstatus wird geprüft ...</small>
      <small id="data-status">Datenstand: -</small>
    </header>

    <main class="grid">
      <section class="panel input-panel">
        <h2>Standort</h2>
        <div class="field-grid">
          <label>
            Latitude
            <input id="lat" type="number" step="0.000001" placeholder="51.2500" />
          </label>
          <label>
            Longitude
            <input id="lon" type="number" step="0.000001" placeholder="6.9700" />
          </label>
        </div>

        <label class="search-label">
          Standortsuche (Adresse/Ort)
          <div class="search-row">
            <input id="search-query" type="text" placeholder="z. B. Mettmann Bahnhof" />
            <button id="search-location" class="btn secondary" type="button">Suchen</button>
          </div>
        </label>
        <small id="search-status">Suche über OpenStreetMap Nominatim (DE).</small>
        <ul id="search-results" class="search-results" aria-live="polite"></ul>
        <div id="map" class="map"></div>

        <div class="button-row">
          <button id="use-location" class="btn secondary">Aktuellen Standort nutzen</button>
          <button id="load-score" class="btn">Score für heute Nacht (22-06)</button>
        </div>

        <p class="hint">Night Hours im MVP fix: 22:00 bis 06:00.</p>
      </section>

      <section class="panel result-panel">
        <h2>Quick Decision</h2>
        <div class="decision" id="decision-card">
          <div class="score-wrap">
            <div class="score" id="score">--</div>
            <div class="ampel" id="ampel">-</div>
          </div>
          <p id="night-window">Bezug: Heute Nacht 22:00-06:00</p>
          <ul id="reasons" class="reasons">
            <li>Noch keine Daten geladen.</li>
          </ul>
        </div>

        <h3>Community Signal</h3>
        <div class="signal-grid">
          <button class="btn signal" data-signal="calm">Ruhige Nacht</button>
          <button class="btn signal" data-signal="noise">Lärm</button>
          <button class="btn signal" data-signal="knock">Klopfen</button>
          <button class="btn signal" data-signal="police">Polizei</button>
        </div>
        <small id="signal-status">Noch kein Signal gesendet.</small>
        <small id="queue-status">Warteschlange: 0 ausstehend</small>
      </section>

      <section class="panel admin-panel">
        <h2>Admin</h2>
        <p class="small">Geschützter Bereich für Datenansicht und Event-Verwaltung.</p>

        <div id="admin-setup" class="admin-block hidden">
          <h3>Erst-Setup</h3>
          <label>
            Admin User
            <input id="admin-setup-user" type="text" placeholder="admin" />
          </label>
          <label>
            Admin Passwort
            <input id="admin-setup-pass" type="password" placeholder="mind. 10 Zeichen" />
          </label>
          <button id="admin-setup-submit" class="btn">Admin anlegen</button>
        </div>

        <div id="admin-login" class="admin-block hidden">
          <h3>Login</h3>
          <label>
            User
            <input id="admin-login-user" type="text" placeholder="admin" />
          </label>
          <label>
            Passwort
            <input id="admin-login-pass" type="password" />
          </label>
          <div class="button-row">
            <button id="admin-login-submit" class="btn">Anmelden</button>
            <button id="admin-logout" class="btn secondary">Abmelden</button>
          </div>
        </div>

        <small id="admin-status">Admin-Status wird geladen ...</small>

        <div id="admin-content" class="admin-block hidden">
          <h3>Übersicht</h3>
          <div id="admin-counts" class="admin-counts">-</div>

          <h3>Event-Verwaltung</h3>
          <label>
            Event-ID (leer = neu)
            <input id="admin-event-id" type="text" placeholder="UUID für Update/Delete" />
          </label>
          <div class="field-grid">
            <label>
              Typ
              <select id="admin-event-type">
                <option value="event">event</option>
                <option value="market">market</option>
                <option value="waste">waste</option>
                <option value="construction">construction</option>
              </select>
            </label>
            <label>
              Risk Modifier
              <input id="admin-event-risk" type="number" value="-10" min="-50" max="50" />
            </label>
            <label>
              Latitude
              <input id="admin-event-lat" type="number" step="0.000001" placeholder="51.250000" />
            </label>
            <label>
              Longitude
              <input id="admin-event-lon" type="number" step="0.000001" placeholder="6.973000" />
            </label>
            <label>
              Start (ISO)
              <input id="admin-event-start" type="text" placeholder="2026-02-15T20:00:00Z" />
            </label>
            <label>
              Ende (ISO)
              <input id="admin-event-end" type="text" placeholder="2026-02-16T06:00:00Z" />
            </label>
            <label>
              Source
              <input id="admin-event-source" type="text" value="admin_manual" />
            </label>
          </div>

          <div class="button-row">
            <button id="admin-event-create" class="btn">Event speichern</button>
            <button id="admin-event-delete" class="btn secondary">Event löschen</button>
            <button id="admin-refresh" class="btn secondary">Daten neu laden</button>
          </div>

          <h3>Letzte Events</h3>
          <div id="admin-events" class="admin-list"></div>

          <h3>Letzte Signale</h3>
          <div id="admin-signals" class="admin-list"></div>

          <h3>Datenquellen</h3>
          <div id="admin-sources" class="admin-list"></div>
        </div>
      </section>

      <section class="panel settings-panel">
        <h2>Settings</h2>
        <label class="toggle">
          <input id="signals-enabled" type="checkbox" checked />
          Community Signals aktivieren
        </label>
        <p class="small">Offline werden Signale zwischengespeichert und später gesendet.</p>

        <h3>Rechtliches</h3>
        <ul class="legal">
          <li><a href="#" id="show-attribution">Attribution (OSM/ODbL)</a></li>
          <li><a href="#" id="show-privacy">Datenschutz</a></li>
          <li><a href="#" id="show-imprint">Impressum</a></li>
        </ul>
        <div id="legal-output" class="legal-output"></div>
      </section>
    </main>

    <script src="vendor/leaflet/leaflet.js"></script>
    <script src="app.js"></script>
  </body>
</html>
